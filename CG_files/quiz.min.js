var fist_touch_event=!1,tooltip_active=!0;document.addEventListener("DOMContentLoaded",(function(event){var url_params=window.location.pathname.split("/").slice(1),quiz_id=url_params[2],mod_font_size=.025;void 0!==map_settings.mod_font_size&&(mod_font_size=map_settings.mod_font_size);var mod_marker_size=1;void 0!==map_settings.mod_marker_size&&(mod_marker_size=map_settings.mod_marker_size);var outline_opacity=.8;void 0!==map_settings.outline_opacity&&(outline_opacity=map_settings.outline_opacity);var base_language="en",quiz_language="en";void 0!==quiz.default_language&&(quiz_language=quiz.default_language);var external_lang_loaded=!1,sound_on=!0,labels_created=!1,labels_visible=!1,pause_quiz=!1,quiz_done=!1,game_mode=GM_DEFAULT,pic_quiz=!1,difficulty_levels=0,default_difficulty_level=-1,current_difficulty=0,startTime=null,timePassed=0,animating_RedToWhite=!1;void 0!==map_settings.game_mode&&(game_mode=map_settings.game_mode),void 0!==quiz.pic_quiz&&(pic_quiz=!0),void 0!==quiz.difficulty_levels&&(difficulty_levels=quiz.difficulty_levels),void 0!==quiz.default_difficulty_level&&(default_difficulty_level=quiz.default_difficulty_level),quiz.total_questions=0,quiz.solved_questions=0,quiz.attempts=0,quiz.current_question=0,questions.forEach((function(q){q.done=!1,q.tries=0}));var backup_questions=Array.from(questions),lS_gmode="gmode_"+quiz_id;game_mode==GM_DEFAULT||game_mode==GM_HIDE_ANSWER||game_mode==GM_TYPEIN_ORDER||game_mode==GM_TYPEIN_NOORDER?null!==localStorage.getItem(lS_gmode)&&(localStorage.getItem(lS_gmode)!=GM_DEFAULT?game_mode=localStorage.getItem(lS_gmode):localStorage.removeItem(lS_gmode),document.getElementById("select_game_mode").value=game_mode):document.getElementById("div_select_gm").style.display="none",game_mode==GM_MULTIPLE&&(document.getElementById("btn_show_all").style.display="none");var lS_qlang="qlang_"+quiz_id;if(null!==localStorage.getItem(lS_qlang)&&(quiz_language=localStorage.getItem(lS_qlang)),void 0!==quiz.lang_file&&("de"!=quiz_language&&"en"!=quiz_language||void 0!==quiz.default_language)){var cVer="";null!==sessionStorage.getItem("content_ver")&&(cVer="?v="+sessionStorage.getItem("content_ver")),getScript("quiz/"+quiz.lang_file+".min.js"+cVer,(function(){questions.forEach((function(q){let i_lang_data=getIndexOf(lang_data,q.item_id);!1!==i_lang_data&&Object.assign(q,lang_data[i_lang_data])})),"undefined"!=typeof legend_data&&legend.forEach((function(l){let i_legend_data=getIndexOf(legend_data,l.item_id);!1!==i_legend_data&&Object.assign(l,legend_data[i_legend_data])})),updateInfobars(),external_lang_loaded=!0}))}function getAltNames(current_question,language){let alt_names="";return void 0!==questions[current_question].alt_names&&("string"==typeof questions[current_question].alt_names?alt_names=" <span class='alt_names'>("+questions[current_question].alt_names+")</span>":void 0!==questions[current_question].alt_names[language]&&(alt_names=" <span class='alt_names'>("+questions[current_question].alt_names[language]+")</span>")),alt_names}supportsFlagEmoji&&document.querySelectorAll(".flag_emoji").forEach(element=>{element.classList.remove("d-none")}),void 0!==quiz.lang_options?quiz.lang_options.forEach((function(e){let str_language="English";switch(e){case"en":break;case"hi":str_language="Hindi";break;case"bn":str_language="Bengali";break;case"mr":str_language="Marathi";break;case"te":str_language="Telugu";break;case"ta":str_language="Tamil";break;case"gu":str_language="Gujarati";break;case"ur":str_language="Urdu";break;case"kn":str_language="Kannada";break;case"fr":str_language="French";break;case"es":str_language="Spanish";break;case"pt":str_language="Portuguese";break;case"de":str_language="German";break;case"it":str_language="Italian";break;case"nl":str_language="Dutch";break;case"el":str_language="Greek";break;case"pl":str_language="Polish";break;case"fa":str_language="Persian";break;case"ar":str_language="Arabic";break;case"he":str_language="Hebr√§isch";break;case"ru":str_language="Russian";break;case"uk":str_language="Ukrainian";break;case"tr":str_language="Turkish";break;case"da":str_language="Danish";break;case"hu":str_language="Hungarian";break;case"ro":str_language="Romanian";break;case"bg":str_language="Bulgarian";break;case"cs":str_language="Czech";break;case"af":str_language="Afrikaans";break;case"zu":str_language="Zulu";break;case"xh":str_language="Xhosa";break;case"abr":str_language="Abbreviations";break;case"nick":str_language="Nicknames";break;case"motto":str_language="Mottos";break;case"IATA":str_language="IATA-Code";break;case"ICAO":str_language="ICAO-Code";break;case"num":str_language="Numeric";break;case"la":str_language="Latin";break;case"ja":str_language="Japanese";break;case"sv":str_language="Swedish";break;case"no":case"nb":str_language="Norwegian";break;case"ko":str_language="Korean";break;case"th":str_language="Thai";break;case"zh_CN":str_language="Chinese (simplified)";break;case"zh_TW":str_language="Chinese (traditional)";break;case"pinyin":str_language="Pinyin";break;case"sk":str_language="Slovak";break;case"is":str_language="Icelandic";break;case"fi":str_language="Finnish";break;case"ga":str_language="Gaelic";break;case"cy":str_language="Welsh";break;case"sw":str_language="Swahili"}document.getElementById("select_lang").add(new Option(str_language,e)),quiz_language==e&&(document.getElementById("select_lang").value=e)})):document.getElementById("div_select_lang").style.display="none",null!==localStorage.getItem("sound_on")&&"false"==localStorage.getItem("sound_on")&&(sound_on=!1,document.getElementById("img_mute").src="ico/volume-mute-fill.svg"),shuffle(questions),quiz.total_questions=questions.length,updateInfobars();var max_map_height=window.document.documentElement.clientHeight-110;if(map_settings.bigger_map){let height_factor=1;void 0!==map_settings.bigger_map_factor&&(height_factor=map_settings.bigger_map_factor),max_map_height=(window.document.documentElement.clientHeight-27)*height_factor}var ignore_min_map_height=!1,min_map_height=300;map_settings.base_svg_width>map_settings.base_svg_height&&window.document.documentElement.clientHeight>window.document.documentElement.clientWidth&&(ignore_min_map_height=!0);var quiz_container_width=document.getElementById("quiz_container").clientWidth,map_width=quiz_container_width,map_height=map_width*(map_settings.base_svg_height/map_settings.base_svg_width);map_height>max_map_height&&(map_width=(map_height=max_map_height)*(map_settings.base_svg_width/map_settings.base_svg_height)),!ignore_min_map_height&&map_height<300&&(map_width=(map_height=300)*(map_settings.base_svg_width/map_settings.base_svg_height));var mod_x=map_width/map_settings.base_svg_width,mod_y=map_height/map_settings.base_svg_height,draw=SVG().addTo("#div_svgmap").size(map_width,map_height);draw.svg(svg_file),SVG("#svg_map").size(map_width);var vbox_stroke=2*map_settings.base_stroke_width;SVG("#svg_map").viewbox(vbox_stroke*mod_x,vbox_stroke*mod_y,map_width-2*vbox_stroke*mod_x,map_height-2*vbox_stroke*mod_y),SVG(".content").size(map_width,map_height),document.getElementById("div_svgmap").style.width=map_width+"px",document.getElementById("div_svgmap").style.height=map_height+"px",document.getElementById("div_info_bar").style.width=map_width+"px",document.getElementById("div_map_toolbar").style.width=map_width+"px",document.getElementById("div_description").style.width=map_width+"px";var el_taglink=document.getElementById("div_link_to_main_tag");null!=el_taglink&&(el_taglink.style.width=document.getElementById("div_description").style.width);var el_gallerylink=document.getElementById("div_link_to_gallery");null!=el_gallerylink&&(el_gallerylink.style.width=document.getElementById("div_description").style.width);var el_desc_affected=document.getElementById("div_desc_affected");null!=el_desc_affected&&(el_desc_affected.style.width=document.getElementById("div_description").style.width),void 0!==quiz.quiz_items&&quiz.quiz_items.forEach((function(e){SVG.find("#"+e).addClass("quiz_item")})),void 0!==quiz.noquiz_regions&&quiz.noquiz_regions.forEach((function(e){SVG.find("#"+e).addClass("noquiz_region")})),game_mode!=GM_FIND_ALL&&game_mode!=GM_MULTIPLE||void 0!==quiz.fake_quiz_items&&quiz.fake_quiz_items.forEach((function(e){SVG.find("#"+e).addClass("fake_quiz_item")})),SVG.find(".region").fill(map_colors.region_fill),SVG.find(".region").stroke({color:map_colors.region_stroke,width:map_settings.base_stroke_width}),SVG.find(".noquiz_region").fill(map_colors.noquiz_region_fill),SVG.find(".noquiz_region").stroke({color:map_colors.noquiz_region_stroke,width:map_settings.base_stroke_width}),SVG.find(".noquiz_sea").fill(map_colors.noquiz_sea),SVG.find(".noquiz_lake").attr({fill:map_colors.noquiz_sea,opacity:.8,stroke:"none","pointer-events":"none"}),SVG.find(".river").attr({fill:"none",stroke:map_colors.river,"stroke-width":4}),SVG.find(".noquiz_river").attr({fill:"none",stroke:map_colors.noquiz_sea,"stroke-width":4,opacity:.8,"pointer-events":"none"}),SVG.find(".noquiz_river_medium").attr({fill:"none",stroke:map_colors.noquiz_sea,"stroke-width":3,opacity:.8,"pointer-events":"none"}),SVG.find(".noquiz_river_small").attr({fill:"none",stroke:map_colors.noquiz_sea,"stroke-width":2,opacity:.8,"pointer-events":"none"}),SVG.find(".noquiz_road").attr({fill:"none",stroke:map_colors.noquiz_road,"stroke-width":3,opacity:.8,"pointer-events":"none"}),SVG.find(".street").attr({fill:"none",stroke:map_colors.street,"stroke-width":4}),SVG.find(".outline").attr({"stroke-width":2,opacity:outline_opacity}),SVG.find(".noquiz_shadow").attr({fill:"none",stroke:"grey","stroke-width":4}),SVG.find(".remote_clickable").attr({fill:"#000087",stroke:"none",opacity:.08});var pattern_checker=draw.pattern(10,10,(function(add){add.rect(10,10).fill(map_colors.region_fill),add.rect(5,5).fill("#1b1ede"),add.rect(5,5).move(5,5).fill("#1b1ede")}));if(void 0!==quiz.hide&&quiz.hide.forEach((function(e){SVG.find("."+e).hide()})),void 0!==quiz.show&&quiz.show.forEach((function(e){SVG.find("."+e).show()})),void 0!==quiz.repaint)for(var prop in quiz.repaint)SVG.find("."+prop).fill(quiz.repaint[prop].fill),SVG.find("."+prop).stroke(quiz.repaint[prop].stroke);if(void 0!==quiz.autocalc_clickable&&1==quiz.autocalc_clickable){var list_quiz_items=SVG.find(".quiz_item"),arr_places=[],arr_dist=[];list_quiz_items.each((function(qr){let c=qr.findOne(".clickable");arr_places.push([qr.id(),c.cx(),c.cy()]),qr.show()})),arr_places.forEach((function(e){var smallest_dist=1e4,A_ID,B_ID;arr_places.forEach((function(e2){if(e[0]!=e2[0]){let dx=e[1]-e2[1],dy=e[2]-e2[2],dist=Math.sqrt(dx*dx+dy*dy);dist<smallest_dist&&(smallest_dist=dist,A_ID=e[0],B_ID=e2[0])}})),arr_dist.push([A_ID,smallest_dist,B_ID,touching=!1])})),arr_dist.sort((function compareSecondColumn(a,b){return a[1]===b[1]?0:a[1]<b[1]?-1:1})),arr_dist.forEach((function(e){arr_dist.forEach((function(e2){e[2]==e2[0]&&e[1]==e2[1]&&(e[3]=!0)}))})),arr_dist.forEach((function(e){!1===e[3]&&arr_dist.forEach((function(e2){e[2]==e2[0]&&(e[1]=e[1]+(e[1]-e2[1]))}))})),arr_dist.forEach((function(e){let c=SVG.find("#"+e[0]).findOne(".clickable"),r=e[1]/2,cx=c.cx()[0],cy=c.cy()[0];cx-r<0&&(r=cx-1),cy-r<0&&(r=cy-1),cx+r>map_settings.base_svg_width&&(r=map_settings.base_svg_width-cx-1),cy+r>map_settings.base_svg_height&&(r=map_settings.base_svg_height-cy-1),c.radius(r)}))}if(void 0!==quiz.resize_clickable)for(var prop in quiz.resize_clickable)SVG.find("#"+prop).findOne(".clickable").radius(quiz.resize_clickable[prop]);var list_cities=SVG.find(".quiz_item.place");list_cities&&list_cities.length>0&&(SVG.find(".clickable").opacity(0),list_cities.each((function(c){let marker_x=c.findOne(".clickable").cx(),marker_y=c.findOne(".clickable").cy();if(c.hasClass("triangle")){let polygon=draw.polygon("50,13.4 100,100 0,100");polygon.fill("#000000").move(marker_x-10,marker_y-10),polygon.size(20);let polygon2=draw.polygon("50,13.4 100,100 0,100");polygon2.fill("#ffffff").move(marker_x-6.5,marker_y-5.9),polygon2.size(13),polygon2.addClass("marker");let polygroup=draw.group();polygroup.add(polygon),polygroup.add(polygon2),polygroup.transform({origin:"center",scale:mod_marker_size}),c.add(polygroup)}else{let circle_marker=draw.circle(7).cx(marker_x).cy(marker_y);circle_marker.attr({r:7*mod_marker_size,fill:map_colors.place,"stroke-width":2*mod_marker_size,stroke:"#333"}),circle_marker.addClass("marker"),c.add(circle_marker)}let circle_hover=draw.circle(18).cx(marker_x).cy(marker_y);circle_hover.attr({r:18*mod_marker_size,fill:"none","stroke-width":5*mod_marker_size,stroke:"black",opacity:0,"pointer-events":"none"}),circle_hover.addClass("hover"),c.add(circle_hover);let circle_hover2=draw.circle(21).cx(marker_x).cy(marker_y);circle_hover2.attr({r:21*mod_marker_size,fill:"none","stroke-width":2*mod_marker_size,stroke:"black",opacity:0,"pointer-events":"none"}),circle_hover2.addClass("hover2"),c.add(circle_hover2)})));var list_paths=SVG.find(".quiz_item.path");list_paths&&list_paths.length>0&&list_paths.each((function(c){let clone=c.findOne(".item_path").clone();clone.attr({"stroke-width":13,opacity:0}),c.add(clone),c.hasClass("street")?c.data("base_color",map_colors.street):c.hasClass("river")&&c.data("base_color",map_colors.river)}));var audio_format="ogg",audio_test=new Audio;audio_test.canPlayType('audio/ogg; codecs="vorbis"')?audio_format="ogg":audio_test.canPlayType("audio/mpeg;")&&(audio_format="mp3");const audioCtx=new AudioContext;audioCtx.createGain();var soundbuffer=[],sfx_preloaded=!1;const loadSoundFile=(filename,str_id)=>{const request=new XMLHttpRequest;let url="/sfx/"+filename+"."+audio_format;request.open("GET",url),request.responseType="arraybuffer",request.onload=function(){let undecodedAudio=request.response;audioCtx.decodeAudioData(undecodedAudio,data=>soundbuffer[str_id]=data)},request.send()};loadSoundFile("correct2","correct"),loadSoundFile("incorrect2","incorrect"),loadSoundFile("failed","failed");const playSound=str=>{if(sound_on){const source=audioCtx.createBufferSource();source.buffer=soundbuffer[str],source.connect(audioCtx.destination),source.start(0)}};var modal_quiz_done=new bootstrap.Modal(document.getElementById("modal_quiz_done")),timeoutID;function ResetGame(){questions.splice(0,questions.length,...backup_questions),labels_visible&&document.getElementById("btn_show_all").click(),SVG.find(".quiz_label").remove(),labels_created=!1;for(let i=questions.length-1;i>=0;i--)eSVG=SVG.find("#"+questions[i].item_id),difficulty_levels>0&&!1===quiz.difficulty[current_difficulty].includes(questions[i].item_id)?(eSVG.removeClass("quiz_item"),eSVG.addClass("events_disabled"),eSVG.fill("#C7BFB7"),eSVG.stroke({color:map_colors.noquiz_region_stroke,width:map_settings.base_stroke_width}),questions.splice(i,1)):(eSVG.addClass("quiz_item"),eSVG.removeClass("events_disabled"),eSVG.fill(map_colors.region_fill),eSVG.stroke({color:map_colors.region_stroke,width:map_settings.base_stroke_width}));if(quiz.total_questions=0,quiz.solved_questions=0,quiz.attempts=0,quiz.current_question=0,questions.forEach((function(q){q.done=!1,q.tries=0})),shuffle(questions),quiz.total_questions=questions.length,game_mode==GM_TYPEIN_ORDER||game_mode==GM_TYPEIN_NOORDER){document.getElementById("div_type_in").classList.add("d-flex"),document.getElementById("div_type_in").style.display="block",SVG.find(".quiz_item").addClass("events_disabled");let svg_quiz_item=SVG.find("#"+questions[quiz.current_question].item_id)[0];highlightQuizItem(svg_quiz_item),positionInputBox(svg_quiz_item),document.getElementById("input_typein").focus(),SVG.find(".remote_clickable").hide()}else document.getElementById("div_type_in").style.display="none",document.getElementById("div_type_in").classList.remove("d-flex"),SVG.find(".remote_clickable").show();updateInfobars()}game_mode==GM_TYPEIN_ORDER||game_mode==GM_TYPEIN_NOORDER?ResetGame():(document.getElementById("div_type_in").style.display="none",document.getElementById("div_type_in").classList.remove("d-flex")),SVG.find(".quiz_item").click((function(){if(!pause_quiz&&!quiz_done&&!this.hasClass("events_disabled")){if(window.getSelection().removeAllRanges(),null===startTime&&(startTime=new Date),game_mode==GM_FIND_ALL){quiz.attempts++;let i_question=getIndexOf(questions,this.id());return void(!1===questions[i_question].done&&(playSound("correct"),questions[i_question].done=!0,quiz.solved_questions++,this.fill({color:map_colors.color_green}),updateInfobars(),quiz.solved_questions==quiz.total_questions&&quizDone()))}let lpos="none",extra_label="";if("place"==questions[quiz.current_question].type&&(lpos="top"),void 0!==questions[quiz.current_question].greater_region&&void 0!==questions[quiz.current_question].greater_region[quiz_language]){let arr_gregion=questions[quiz.current_question].greater_region[quiz_language].split("|");extra_label=arr_gregion.length>1?arr_gregion[1]+" "+arr_gregion[0]:"de"==quiz_language||"en"==quiz_language?"in "+arr_gregion[0]:arr_gregion[0]}let region_cx=0,region_cy=0;if(this.id()==questions[quiz.current_question].item_id){if(playSound("correct"),"region"==questions[quiz.current_question].type||"path"==questions[quiz.current_question].type)if(void 0!==this.data("xy")){let arr_xy=this.data("xy").split(",");region_cx=arr_xy[0]*mod_x,region_cy=arr_xy[1]*mod_y}else region_cx=this.cx()*mod_x,region_cy=this.cy()*mod_y;else"place"==questions[quiz.current_question].type&&(region_cx=this.findOne(".clickable").cx()*mod_x,region_cy=this.findOne(".clickable").cy()*mod_y);game_mode!=GM_MULTIPLE?animateLabel(region_cx,region_cy,questions[quiz.current_question].item_title[quiz_language],1e3,lpos,extra_label):animateLabel(region_cx,region_cy,questions[quiz.current_question].gm_multiple_label[quiz_language],1e3,lpos,extra_label),0==questions[quiz.current_question].tries?colorQuizItem(map_colors.color_green,this):1!=questions[quiz.current_question].tries&&2!=questions[quiz.current_question].tries||colorQuizItem(map_colors.color_yellow,this),questions[quiz.current_question].done=!0,questions[quiz.current_question].tries++,quiz.current_question++,quiz.current_question==quiz.total_questions?quizDone():(updateQuestionCaptions("current","current","current"),pic_quiz&&(document.getElementById("pic_quiz_modal_image").src="img/flags/"+questions[quiz.current_question].img_filename,modal_show_image.show(),void 0!==questions[quiz.current_question+1]&&preload_image("img/flags/"+questions[quiz.current_question+1].img_filename)))}else{if(game_mode!=GM_MULTIPLE&&game_mode!=GM_HIDE_ANSWER){var i_questions=getIndexOf(questions,this.id());if(fist_touch_event&&questions[i_questions].done)return}if(questions[quiz.current_question].tries++,3==questions[quiz.current_question].tries){if(questions[quiz.current_question].done=!0,questions[quiz.current_question].tries=4,game_mode!=GM_MULTIPLE){if("region"==questions[quiz.current_question].type||"path"==questions[quiz.current_question].type)if(void 0!==SVG.find("#"+questions[quiz.current_question].item_id).data("xy")[0]){let arr_xy=SVG.find("#"+questions[quiz.current_question].item_id).data("xy")[0].split(",");region_cx=arr_xy[0]*mod_x,region_cy=arr_xy[1]*mod_y}else region_cx=SVG.find("#"+questions[quiz.current_question].item_id).cx()[0]*mod_x,region_cy=SVG.find("#"+questions[quiz.current_question].item_id).cy()[0]*mod_y;else"place"==questions[quiz.current_question].type&&(region_cx=SVG.find("#"+questions[quiz.current_question].item_id).findOne(".clickable").cx()[0]*mod_x,region_cy=SVG.find("#"+questions[quiz.current_question].item_id).findOne(".clickable").cy()[0]*mod_y);animateLabel(region_cx,region_cy,questions[quiz.current_question].item_title[quiz_language],1e3,lpos)}playSound("failed"),colorQuizItem(map_colors.color_red,SVG.find("#"+questions[quiz.current_question].item_id)),quiz.current_question++,quiz.current_question==quiz.total_questions?quizDone():(updateQuestionCaptions("current","current","current"),pic_quiz&&(document.getElementById("pic_quiz_modal_image").src="img/flags/"+questions[quiz.current_question].img_filename,modal_show_image.show(),void 0!==questions[quiz.current_question+1]&&preload_image("img/flags/"+questions[quiz.current_question+1].img_filename)))}else{if(game_mode!=GM_MULTIPLE){let i_question=getIndexOf(questions,this.id());if("region"==questions[i_question].type||"path"==questions[i_question].type)if(void 0!==this.data("xy")){let arr_xy=this.data("xy").split(",");region_cx=arr_xy[0]*mod_x,region_cy=arr_xy[1]*mod_y}else region_cx=this.cx()*mod_x,region_cy=this.cy()*mod_y;else"place"==questions[i_question].type&&(region_cx=this.findOne(".clickable").cx()*mod_x,region_cy=this.findOne(".clickable").cy()*mod_y);animateLabel(region_cx,region_cy,questions[i_question].item_title[quiz_language],1e3,lpos)}else this.fill({color:map_colors.color_grey}),animateResetColor(this,{fill:map_colors.region_fill});playSound("incorrect")}}}})),SVG.find(".quiz_item").mouseover((function(){if(!pause_quiz&&!quiz_done&&!this.hasClass("events_disabled")&&!1===fist_touch_event){var i_questions=getIndexOf(questions,this.id());if(this.hasClass("region")){if(((game_mode==GM_DEFAULT||game_mode==GM_FIND_ALL)&&!1===questions[i_questions].done||game_mode==GM_HIDE_ANSWER||game_mode==GM_MULTIPLE)&&!1===this.hasClass("highlighted")&&!1===this.hasClass("animating")){this.addClass("highlighted");var darkerColor=adjustColor(map_colors.region_fill,-25);this.node.setAttribute("fill",darkerColor)}}else if(this.hasClass("place"))this.findOne(".hover").opacity(.15),this.findOne(".hover2").opacity(.3);else if(this.hasClass("path")&&(game_mode==GM_DEFAULT&&!1===questions[i_questions].done||game_mode==GM_HIDE_ANSWER)&&!1===this.hasClass("highlighted")&&!1===this.hasClass("animating")){this.addClass("highlighted");var newColor=adjustColor(this.data("base_color"),-90);this.hasClass("river")&&(newColor="#ffffff"),this.stroke({color:newColor})}}})),game_mode!=GM_FIND_ALL&&game_mode!=GM_MULTIPLE||SVG.find(".fake_quiz_item").mouseover((function(){if(!pause_quiz&&!quiz_done&&!1===fist_touch_event&&this.hasClass("region")&&!1===this.hasClass("highlighted")&&!1===this.hasClass("animating")){this.addClass("highlighted");var darkerColor=adjustColor(map_colors.region_fill,-25);this.fill({color:darkerColor})}})),SVG.find(".quiz_item").mouseout((function(){if(!pause_quiz&&!quiz_done&&!this.hasClass("events_disabled")){var i_questions=getIndexOf(questions,this.id());this.hasClass("region")?(game_mode!=GM_DEFAULT&&game_mode!=GM_FIND_ALL||!1!==questions[i_questions].done)&&game_mode!=GM_HIDE_ANSWER&&game_mode!=GM_MULTIPLE||this.hasClass("highlighted")&&(!1===this.hasClass("animating")&&this.node.setAttribute("fill",map_colors.region_fill),this.removeClass("highlighted")):this.hasClass("place")?(this.findOne(".hover").opacity(0),this.findOne(".hover2").opacity(0)):this.hasClass("path")&&(game_mode==GM_DEFAULT&&!1===questions[i_questions].done||game_mode==GM_HIDE_ANSWER)&&this.hasClass("highlighted")&&(!1===this.hasClass("animating")&&this.stroke({color:this.data("base_color")}),this.removeClass("highlighted"))}})),game_mode!=GM_FIND_ALL&&game_mode!=GM_MULTIPLE||SVG.find(".fake_quiz_item").mouseout((function(){pause_quiz||quiz_done||this.hasClass("region")&&(this.hasClass("failed")||this.hasClass("highlighted")&&(!1===this.hasClass("animating")&&this.fill({color:map_colors.region_fill}),this.removeClass("highlighted")))})),SVG.find(".fake_quiz_item").click((function(){pause_quiz||quiz_done||(window.getSelection().removeAllRanges(),game_mode==GM_MULTIPLE?(questions[quiz.current_question].tries++,3==questions[quiz.current_question].tries?(questions[quiz.current_question].done=!0,questions[quiz.current_question].tries=4,playSound("failed"),"region"==questions[quiz.current_question].type&&(game_mode==GM_DEFAULT||game_mode==GM_FIND_ALL?SVG.find("#"+questions[quiz.current_question].item_id).fill(map_colors.color_red):game_mode!=GM_HIDE_ANSWER&&game_mode!=GM_MULTIPLE||(SVG.find("#"+questions[quiz.current_question].item_id).fill(map_colors.color_red),animateResetColor(SVG.find("#"+questions[quiz.current_question].item_id),{fill:map_colors.region_fill}))),quiz.current_question++,quiz.current_question==quiz.total_questions?quizDone():updateQuestionCaptions("current","current","current")):(this.fill({color:map_colors.color_grey}),animateResetColor(this,{fill:map_colors.region_fill}),playSound("incorrect"))):this.hasClass("failed")||(playSound("failed"),"region"==questions[quiz.current_question].type&&(game_mode!=GM_DEFAULT&&game_mode!=GM_FIND_ALL||(this.fill({color:map_colors.color_red}),this.addClass("failed"))),quiz.attempts++,updateInfobars()))})),SVG.find(".remote_clickable").click((function(){SVG("#"+this.data("region_id")).fire("click")})),SVG.find(".remote_clickable").mouseover((function(){SVG("#"+this.data("region_id")).fire("mouseover"),pause_quiz||quiz_done||!1===fist_touch_event&&!1===this.hasClass("highlighted")&&(this.addClass("highlighted"),this.opacity(.12))})),SVG.find(".remote_clickable").mouseout((function(){SVG("#"+this.data("region_id")).fire("mouseout"),pause_quiz||quiz_done||this.hasClass("highlighted")&&(this.opacity(.08),this.removeClass("highlighted"))})),window.addEventListener("resize",(function(){if(labels_created&&(SVG.find(".quiz_label").remove(),labels_created=!1),SVG.find(".hover").remove(),SVG.find(".hover2").remove(),max_map_height=window.document.documentElement.clientHeight-110,map_settings.bigger_map){let height_factor=1;void 0!==map_settings.bigger_map_factor&&(height_factor=map_settings.bigger_map_factor),max_map_height=(window.document.documentElement.clientHeight-27)*height_factor}map_settings.base_svg_width>map_settings.base_svg_height&&(ignore_min_map_height=window.document.documentElement.clientHeight>window.document.documentElement.clientWidth);var new_map_width=quiz_container_width=document.getElementById("quiz_container").clientWidth,new_map_height=new_map_width*(map_settings.base_svg_height/map_settings.base_svg_width);new_map_height>max_map_height&&(new_map_width=(new_map_height=max_map_height)*(map_settings.base_svg_width/map_settings.base_svg_height)),!ignore_min_map_height&&new_map_height<300&&(new_map_width=(new_map_height=300)*(map_settings.base_svg_width/map_settings.base_svg_height)),mod_x=new_map_width/map_settings.base_svg_width,mod_y=new_map_height/map_settings.base_svg_height,draw.size(new_map_width),SVG("#svg_map").size(new_map_width),SVG("#svg_map").viewbox(vbox_stroke*mod_x,vbox_stroke*mod_y,new_map_width-2*vbox_stroke*mod_x,new_map_height-2*vbox_stroke*mod_y),SVG(".content").size(new_map_width,new_map_height),list_cities&&list_cities.length>0&&(SVG.find(".clickable").opacity(0),list_cities.each((function(c){let marker_x=c.findOne(".clickable").cx(),marker_y=c.findOne(".clickable").cy(),circle_hover=draw.circle(18).cx(marker_x).cy(marker_y);circle_hover.attr({r:18*mod_marker_size,fill:"none","stroke-width":5*mod_marker_size,stroke:"black",opacity:0,"pointer-events":"none"}),circle_hover.addClass("hover"),c.add(circle_hover);let circle_hover2=draw.circle(21).cx(marker_x).cy(marker_y);circle_hover2.attr({r:21*mod_marker_size,fill:"none","stroke-width":2*mod_marker_size,stroke:"black",opacity:0,"pointer-events":"none"}),circle_hover2.addClass("hover2"),c.add(circle_hover2)}))),document.getElementById("div_svgmap").style.width=new_map_width+"px",document.getElementById("div_svgmap").style.height=new_map_height+"px",document.getElementById("div_info_bar").style.width=new_map_width+"px",document.getElementById("div_map_toolbar").style.width=new_map_width+"px",document.getElementById("div_description").style.width=new_map_width+"px";var el_taglink=document.getElementById("div_link_to_main_tag");null!=el_taglink&&(el_taglink.style.width=document.getElementById("div_description").style.width);var el_desc_affected=document.getElementById("div_desc_affected");if(null!=el_desc_affected&&(el_desc_affected.style.width=document.getElementById("div_description").style.width),game_mode==GM_TYPEIN_ORDER||game_mode==GM_TYPEIN_NOORDER){let svg_quiz_item;positionInputBox(SVG.find("#"+questions[quiz.current_question].item_id)[0])}clearTimeout(timeoutID),timeoutID=setTimeout((function(){labels_visible&&showLabels()}),100)}));var lS_diffLvl="diffLvl"+quiz_id;if(difficulty_levels>0){var modal_difficulty=new bootstrap.Modal(document.getElementById("modal_choose_difficulty"));if(null!==localStorage.getItem(lS_diffLvl))current_difficulty=localStorage.getItem(lS_diffLvl),ResetGame();else if(default_difficulty_level>-1)current_difficulty=default_difficulty_level,ResetGame();else{let str_content="<form>",str_checked=" checked";for(let i=0;i<difficulty_levels;i++)str_checked=0==i?" checked":"",str_content+="<div class='form-check'>",str_content=str_content+"<input class='form-check-input' type='radio' value='"+i+"' name='radioChooseDiffLvl' id='radioChooseDiffLvl"+String(i+1)+"'"+str_checked+">",str_content=str_content+"<label class='form-check-label' for='radioChooseDiffLvl"+String(i+1)+"'>"+quiz.difficulty_labels[i].en+"</label>",str_content+="</div>";str_content+="</form>",document.getElementById("div_choose_difficulty").innerHTML=str_content,document.getElementById("btn_dismiss_choose_difficulty").style.display="none",modal_difficulty._config.keyboard=!1,modal_difficulty.show()}}else document.getElementById("btn_diffLvl").style.display="none";if(!0===pic_quiz){var modal_show_image=new bootstrap.Modal(document.getElementById("modal_show_image"));document.getElementById("pic_quiz_modal_image").src="img/flags/"+questions[quiz.current_question].img_filename,modal_show_image.show(),void 0!==questions[quiz.current_question+1]&&preload_image("img/flags/"+questions[quiz.current_question+1].img_filename)}else document.getElementById("btn_show_img").style.display="none";function quizDone(){updateQuestionCaptions(quiz.current_question+"/"+quiz.total_questions+" Quiz done!","Quiz done!","none"),quiz_done=!0;let currentTime=new Date;timePassed=currentTime-startTime,startTime=null,game_mode==GM_HIDE_ANSWER?recolorQuizItems():game_mode==GM_FIND_ALL?SVG.find(".fake_quiz_item").each((function(e){e.hasClass("failed")||e.fill({color:map_colors.noquiz_region_fill}),e.stroke({color:map_colors.noquiz_region_stroke})})):game_mode!=GM_TYPEIN_ORDER&&game_mode!=GM_TYPEIN_NOORDER||(document.getElementById("div_type_in").style.display="none",document.getElementById("div_type_in").classList.remove("d-flex")),showResults()}function updateQuestionCaptions(div_question,div_info_bar,tooltip){let str_click_on="";void 0!==quiz.hide_click_on&&!0===quiz.hide_click_on&&(str_click_on=""),void 0!==quiz.str_custom_click_on&&(str_click_on=quiz.str_custom_click_on[quiz_language]),document.getElementById("div_question").innerHTML="current"==div_question?pic_quiz?quiz.current_question+"/"+quiz.total_questions+" - "+str_click_on+" associated region":quiz.current_question+"/"+quiz.total_questions+" - "+str_click_on+questions[quiz.current_question].item_title[quiz_language]:div_question,document.getElementById("div_info_bar").innerHTML="current"==div_info_bar?pic_quiz?fist_touch_event?"Click on <i>Show image</i> to see the quiz image again":"Click on <i>Show image</i> to enlarge the quiz image":str_click_on+questions[quiz.current_question].item_title[quiz_language]+getAltNames(quiz.current_question,quiz_language):div_info_bar;let div_tooltip=document.getElementById("tooltip");"none"==tooltip?tooltip_active=!1:"current"==tooltip?(pic_quiz?(div_tooltip.innerHTML="<img src='img/flags/"+questions[quiz.current_question].img_filename+"' style='width:200px; height:auto;'>",div_tooltip.style.padding="0px"):div_tooltip.innerHTML=str_click_on+questions[quiz.current_question].item_title[quiz_language],tooltip_active=!0):(div_tooltip.innerHTML=tooltip,tooltip_active=!0)}function updateInfobars(){game_mode==GM_DEFAULT||game_mode==GM_HIDE_ANSWER||game_mode==GM_MULTIPLE?updateQuestionCaptions("current","current","current"):game_mode==GM_FIND_ALL?updateQuestionCaptions(quiz.solved_questions+"/"+quiz.total_questions+" - "+quiz.str_question.en,quiz.str_question.en,quiz.solved_questions+"/"+quiz.total_questions+" - "+quiz.str_question.en):game_mode!=GM_TYPEIN_ORDER&&game_mode!=GM_TYPEIN_NOORDER||updateQuestionCaptions(quiz.current_question+"/"+quiz.total_questions+" - Type in the name of the highlighted region","Type in the name of the highlighted region","none")}function showLabels(){if(labels_visible=!0,document.getElementById("btn_show_all").innerHTML="Hide places",!1===labels_created){labels_created=!0;var region_cx=0,region_cy=0,base_font_size=document.getElementById("div_svgmap").clientHeight*mod_font_size;base_font_size<6&&(base_font_size=6);var rect_height=1.3*base_font_size,font_weight="bold";if("zh_TW"==quiz_language&&(font_weight="normal"),questions.forEach((function(q){var lpos="top",lpos_shift_y=0;if("place"==q.type&&(lpos_shift_y=1.25*-base_font_size),void 0!==q.lpos&&("top"==(lpos=q.lpos)?lpos_shift_y=1.25*-base_font_size:"bottom"==lpos&&(lpos_shift_y=1.35*base_font_size)),void 0!==SVG.find("#"+q.item_id)[0].data("xy")){var arr_xy=SVG.find("#"+q.item_id)[0].data("xy").split(",");region_cx=arr_xy[0]*mod_x,region_cy=arr_xy[1]*mod_y}else"region"==q.type?(region_cx=SVG.find("#"+q.item_id).cx()[0]*mod_x,region_cy=SVG.find("#"+q.item_id).cy()[0]*mod_y):"place"==q.type&&(region_cx=SVG.find("#"+q.item_id).findOne(".clickable").cx()[0]*mod_x,region_cy=SVG.find("#"+q.item_id).findOne(".clickable").cy()[0]*mod_y);var rect=draw.rect().radius(base_font_size/4),text=draw.text(q.item_title[quiz_language]);void 0!==q.short_title&&void 0!==q.short_title[quiz_language]&&text.text(q.short_title[quiz_language]),text.font({size:base_font_size,weight:font_weight});let x_pos=region_cx-text.length()/2;"left"==lpos?(lpos_shift_y=0,x_pos=region_cx-text.length()-.85*base_font_size):"right"==lpos&&(lpos_shift_y=0,x_pos=region_cx+.85*base_font_size);let y_pos=region_cy-.7*base_font_size+lpos_shift_y,x2_pos;x_pos<0&&(x_pos=.2*base_font_size),x_pos+text.length()+.2*base_font_size>SVG("#svg_map").width()&&(x_pos=SVG("#svg_map").width()-text.length()-.2*base_font_size),rect.attr({width:text.length()+.4*base_font_size,height:rect_height,x:x_pos-.2*base_font_size,y:y_pos+base_font_size/20,fill:"#fffffe",opacity:.9}),text.move(x_pos,y_pos),void 0!==q.mod_fsize&&(rect.scale(q.mod_fsize),text.scale(q.mod_fsize)),rect.addClass("quiz_label"),text.addClass("quiz_label"),text.linkTo((function(link){void 0!==q.link_wikipedia&&(void 0!==q.link_wikipedia[quiz_language]?link.to(q.link_wikipedia[quiz_language]).target("_blank"):link.to(q.link_wikipedia.en).target("_blank"))}))})),"undefined"!=typeof legend){var label_font_size=base_font_size;void 0!==map_settings.mod_font_size_lables&&(label_font_size=document.getElementById("div_svgmap").clientHeight*map_settings.mod_font_size_lables),legend.forEach((function(l){if(void 0!==l.item_title[quiz_language]){region_cx=SVG.find("#"+l.item_id).cx()[0]*mod_x,region_cy=SVG.find("#"+l.item_id).cy()[0]*mod_y;let mod_fsize=1;void 0!==l.mod_fsize&&(mod_fsize=l.mod_fsize);var text=draw.text(l.item_title[quiz_language]).fill(l.color);text.font({size:label_font_size*mod_fsize,weight:"normal","pointer-events":"none"});let first_tspan_lenght=0,longest_tspan_lenght=0;text.each((function(i){this.length()>longest_tspan_lenght&&(longest_tspan_lenght=this.length())})),x_pos=region_cx-longest_tspan_lenght/2,text.each((function(i){0==i&&(first_tspan_lenght=this.length()),i>0&&this.dx(first_tspan_lenght/2-this.length()/2)}));let y_pos=region_cy-label_font_size*mod_fsize*.7;text.move(x_pos,y_pos),void 0!==l.rotate&&text.rotate(l.rotate),text.addClass("quiz_label")}}))}}else SVG.find(".quiz_label").show()}function animateLabel(center_x,center_y,labelText,duration=1e3,lpos="none",labelText2=""){let div_map=document.getElementById("div_svgmap");var base_font_size=div_map.clientHeight*mod_font_size;base_font_size<7&&(base_font_size=7);var rect_height=1.3*base_font_size,font_weight="bold";"zh_TW"==quiz_language&&(font_weight="normal");var lpos_shift_y=0;"top"==lpos?lpos_shift_y=1.25*-base_font_size:"bottom"==lpos&&(lpos_shift_y=1.35*base_font_size);var rect=draw.rect().radius(base_font_size/4),text=draw.text(labelText);text.font({size:base_font_size,weight:font_weight,"pointer-events":"none"}),text.addClass("animated_label_text");var x_pos=center_x-text.length()/2,y_pos=center_y-.7*base_font_size+lpos_shift_y;let x2_pos;if(x_pos<0&&(x_pos=.2*base_font_size),x_pos+text.length()+.2*base_font_size>SVG("#svg_map").width()&&(x_pos=SVG("#svg_map").width()-text.length()-.2*base_font_size),labelText2){SVG.find(".svg2ndlabel").remove();var rect2=draw.rect().radius(base_font_size/4);rect2.addClass("svg2ndlabel"),rect2.opacity(.3);var text2=draw.text(labelText2);text2.addClass("svg2ndlabel"),text2.font({size:base_font_size,"pointer-events":"none"}),text2.fill("#eee");var x_pos2=SVG("#svg_map").width()-text2.length()-.5*base_font_size,y_pos2=SVG("#svg_map").height()-1.4*base_font_size;let elemBottom=div_map.getBoundingClientRect().top+window.scrollY+div_map.clientHeight,docViewBottom;window.document.documentElement.scrollTop+window.document.documentElement.clientHeight<elemBottom&&(y_pos2=-1.8)}rect.attr({width:text.length()+.4*base_font_size,height:rect_height,x:x_pos-.2*base_font_size,y:y_pos+base_font_size/20,fill:"#fffffe","pointer-events":"none"}),text.move(x_pos,y_pos);var runner=text.animate(duration,1e3,"now").attr({"fill-opacity":0});if(rect.animate(duration,1e3,"now").attr({"fill-opacity":0}),runner.after((function(){rect.remove(),text.remove()})),labelText2){rect2.attr({width:text2.length()+.4*base_font_size,height:1.2*rect_height,x:x_pos2-.2*base_font_size,y:y_pos2+base_font_size/20,fill:"#000","pointer-events":"none"}),text2.move(x_pos2,y_pos2);var runner2=text2.animate(2500,2e3,"now").attr({"fill-opacity":0});rect2.animate(3e3,2e3,"now").attr({"fill-opacity":0}),runner2.after((function(){rect2.remove(),text2.remove()}))}}function animateResetColor(e,filling){let runner=e.animate(1e3,2e3,"now").attr(filling);e.addClass("animating"),runner.after((function(){runner.element().data("color",null),runner.element().removeClass("animating"),game_mode!=GM_DEFAULT&&!0!==quiz_done||recolorQuizItems()}))}function animateRedToWhite(){if(!1===animating_RedToWhite){animating_RedToWhite=!0;var eInput=document.getElementById("input_typein");let red=255,green=100,blue=100;eInput.style.backgroundColor=`rgb(${red}, ${green}, ${blue})`;var fadeEffect=setInterval((function(){green<255?(green+=10,blue+=10,eInput.style.backgroundColor=`rgb(${red}, ${green}, ${blue})`):(clearInterval(fadeEffect),eInput.style.backgroundColor="#ffffff",animating_RedToWhite=!1)}),30)}}function colorQuizItem(new_color,svg_item){"region"==questions[quiz.current_question].type?game_mode==GM_DEFAULT||game_mode==GM_FIND_ALL||game_mode==GM_TYPEIN_ORDER||game_mode==GM_TYPEIN_NOORDER?svg_item.fill({color:new_color}):game_mode!=GM_HIDE_ANSWER&&game_mode!=GM_MULTIPLE||(svg_item.fill({color:new_color}),animateResetColor(svg_item,{fill:map_colors.region_fill})):"place"==questions[quiz.current_question].type?game_mode==GM_DEFAULT||game_mode==GM_FIND_ALL||game_mode==GM_TYPEIN_ORDER||game_mode==GM_TYPEIN_NOORDER?svg_item.findOne(".marker").fill({color:new_color}):game_mode!=GM_HIDE_ANSWER&&game_mode!=GM_MULTIPLE||(svg_item.findOne(".marker").fill({color:new_color}),animateResetColor(svg_item.findOne(".marker"),{fill:map_colors.place})):"path"==questions[quiz.current_question].type&&(game_mode==GM_DEFAULT||game_mode==GM_FIND_ALL||game_mode==GM_TYPEIN_ORDER||game_mode==GM_TYPEIN_NOORDER?svg_item.stroke({color:new_color}):game_mode!=GM_HIDE_ANSWER&&game_mode!=GM_MULTIPLE||(svg_item.stroke({color:new_color}),animateResetColor(svg_item,{stroke:SVG.find("#"+questions[quiz.current_question].item_id)[0].data("base_color")})))}function highlightQuizItem(svg_item){svg_item.hasClass("region")?svg_item.fill(pattern_checker):svg_item.hasClass("place")?svg_item.findOne(".marker").fill({color:"#000000"}):svg_item.hasClass("path")&&console.log("TODO path")}function recolorQuizItems(){questions.forEach((function(q){!0===q.done&&(1==q.tries?"region"==q.type?SVG.find("#"+q.item_id).fill({color:map_colors.color_green}):"place"==q.type?SVG.find("#"+q.item_id).findOne(".marker").fill({color:map_colors.color_green}):"path"==q.type&&SVG.find("#"+q.item_id).stroke({color:map_colors.color_green}):2==q.tries||3==q.tries?"region"==q.type?SVG.find("#"+q.item_id).fill({color:map_colors.color_yellow}):"place"==q.type?SVG.find("#"+q.item_id).findOne(".marker").fill({color:map_colors.color_yellow}):"path"==q.type&&SVG.find("#"+q.item_id).stroke({color:map_colors.color_yellow}):4==q.tries&&("region"==q.type?SVG.find("#"+q.item_id).fill({color:map_colors.color_red}):"place"==q.type?SVG.find("#"+q.item_id).findOne(".marker").fill({color:map_colors.color_red}):"path"==q.type&&SVG.find("#"+q.item_id).stroke({color:map_colors.color_red})))}))}function showResults(){var hashtag=cyrb53(quiz_id+Date.now()+timePassed);if(document.getElementById("popup_copied").setAttribute("data-hash",hashtag),game_mode==GM_DEFAULT||game_mode==GM_HIDE_ANSWER||game_mode==GM_TYPEIN_ORDER||game_mode==GM_TYPEIN_NOORDER){var solved=[],struggled=[],failed=[],solved_IDs=[],struggled_IDs=[],failed_IDs=[],diff_lvl=-1,max_diff_lvl=0;if(difficulty_levels>0){diff_lvl=current_difficulty;let currentLength=quiz.difficulty[0].length;for(let i=1;i<difficulty_levels;i++)quiz.difficulty[i].length>currentLength&&(currentLength=quiz.difficulty[i].length,max_diff_lvl=i)}for(let i=0;i<quiz.total_questions;i++){let url="";url=void 0!==questions[i].link_wikipedia[quiz_language]?questions[i].link_wikipedia[quiz_language]:questions[i].link_wikipedia.en,1==questions[i].tries?(solved.push("<a href='"+url+"' target='_blank'>"+questions[i].item_title[quiz_language]+"</a>"),solved_IDs.push(questions[i].item_id)):questions[i].tries>1&&questions[i].tries<4?(struggled.push("<a href='"+url+"' target='_blank'>"+questions[i].item_title[quiz_language]+"</a>"),struggled_IDs.push(questions[i].item_id)):4==questions[i].tries&&(failed.push("<a href='"+url+"' target='_blank'>"+questions[i].item_title[quiz_language]+"</a>"),failed_IDs.push(questions[i].item_id))}var str_results="‚úîÔ∏è Correct answers: "+solved.length+" / "+quiz.total_questions+"<br><br>";struggled.length>0&&(str_results=str_results+"‚ûñ Struggled: "+struggled.join(", ")+"<br><br>"),failed.length>0&&(str_results=str_results+"‚ùå Failed: "+failed.join(", ")+"<br>");let minutes=Math.floor(timePassed/6e4),seconds=Math.floor(timePassed%6e4/1e3),milliseconds=timePassed%1e3,str_output_time=null;if(str_output_time=minutes>0?minutes+"m "+seconds+"s "+milliseconds+"ms":seconds+"s "+milliseconds+"ms",game_mode!=GM_TYPEIN_ORDER&&game_mode!=GM_TYPEIN_NOORDER&&solved.length==quiz.total_questions){let lS_timer="qtimer"+quiz_id+"_"+current_difficulty,previousTime=0;if(null!==localStorage.getItem(lS_timer))if(previousTime=localStorage.getItem(lS_timer),timePassed<previousTime)localStorage.setItem(lS_timer,timePassed),str_results=str_results+"<div class='card'><div class='card-body'>üèÜ New best time: "+str_output_time+" ‚úîÔ∏è</div></div>";else{let str_previousTime=null,pt_minutes=Math.floor(previousTime/6e4),pt_seconds=Math.floor(previousTime%6e4/1e3),pt_milliseconds=previousTime%1e3;str_previousTime=minutes>0?pt_minutes+"m "+pt_seconds+"s "+pt_milliseconds+"ms":pt_seconds+"s "+pt_milliseconds+"ms",str_results=str_results+"<div class='card'><div class='card-body text-muted'><div class='d-flex flex-row'><div class='pe-4'>‚è± Current: "+str_output_time+"</div><div>üìã Best: "+str_previousTime+"</div></div></div></div>"}else localStorage.setItem(lS_timer,timePassed)}var formData,request;document.getElementById("div_results").innerHTML=str_results,game_mode!=GM_TYPEIN_ORDER&&game_mode!=GM_TYPEIN_NOORDER&&(document.getElementById("results_runtime").innerHTML="‚è± Time: "+str_output_time),modal_quiz_done.show(),(formData=new FormData).append("quiz_id",quiz_id),formData.append("lang",quiz_language),formData.append("game_mode",game_mode),formData.append("diff_lvl",diff_lvl),formData.append("max_diff_lvl",max_diff_lvl),formData.append("r_solved",solved_IDs),formData.append("r_struggled",struggled_IDs),formData.append("r_failed",failed_IDs),formData.append("timePassed",timePassed),formData.append("hashtag",hashtag),(request=new XMLHttpRequest).open("POST","../store_results.php"),request.send(formData)}else if(game_mode==GM_FIND_ALL){let failed_answers=quiz.attempts-quiz.total_questions;var str_results="Wrong answers: "+failed_answers,formData,request;0==failed_answers&&(str_results="Very good, everything is correct! üòÄ"),document.getElementById("div_results").innerHTML=str_results,modal_quiz_done.show(),(formData=new FormData).append("quiz_id",quiz_id),formData.append("lang",quiz_language),formData.append("game_mode",game_mode),formData.append("diff_lvl",diff_lvl),formData.append("max_diff_lvl",max_diff_lvl),formData.append("r_solved",solved_IDs),formData.append("r_struggled",struggled_IDs),formData.append("r_failed",failed_IDs),formData.append("hashtag",hashtag),(request=new XMLHttpRequest).open("POST","../store_results.php"),request.send(formData)}else if(game_mode==GM_MULTIPLE){var solved=[],struggled=[],failed=[],solved_IDs=[],struggled_IDs=[],failed_IDs=[];for(let i=0;i<quiz.total_questions;i++)1==questions[i].tries?(solved.push(questions[i].item_title[quiz_language]),solved_IDs.push(questions[i].item_id)):questions[i].tries>1&&questions[i].tries<4?(struggled.push(questions[i].item_title[quiz_language]),struggled_IDs.push(questions[i].item_id)):4==questions[i].tries&&(failed.push(questions[i].item_title[quiz_language]),failed_IDs.push(questions[i].item_id));var str_results="Correct answers: "+solved.length+" / "+quiz.total_questions+"<br><br>",formData,request;struggled.length>0&&(str_results=str_results+"Struggled: "+struggled.join(", ")+"<br><br>"),failed.length>0&&(str_results=str_results+"Failed: "+failed.join(", ")+"<br>"),document.getElementById("div_results").innerHTML=str_results,modal_quiz_done.show(),(formData=new FormData).append("quiz_id",quiz_id),formData.append("lang",quiz_language),formData.append("game_mode",game_mode),formData.append("diff_lvl",diff_lvl),formData.append("max_diff_lvl",max_diff_lvl),formData.append("r_solved",solved_IDs),formData.append("r_struggled",struggled_IDs),formData.append("r_failed",failed_IDs),formData.append("hashtag",hashtag),(request=new XMLHttpRequest).open("POST","../store_results.php"),request.send(formData)}}function positionInputBox(svg_e){let divmap_rect=document.getElementById("div_svgmap").getBoundingClientRect(),div_inputbox=document.getElementById("div_type_in");div_inputbox.style.left=svg_e.cx()*mod_x+divmap_rect.left-div_inputbox.offsetWidth/2+"px",svg_e.hasClass("region")?div_inputbox.style.top=svg_e.y()*mod_y+divmap_rect.top+window.scrollY-div_inputbox.offsetHeight-4+"px":svg_e.hasClass("place")?div_inputbox.style.top=svg_e.cy()*mod_y+divmap_rect.top+window.scrollY-div_inputbox.offsetHeight-11*mod_y+"px":svg_e.hasClass("path")&&console.log("TODO path"),div_inputbox.getBoundingClientRect().top<divmap_rect.top&&(div_inputbox.style.top=(svg_e.y()+svg_e.height())*mod_y+divmap_rect.top+window.scrollY+4+"px"),div_inputbox.getBoundingClientRect().left<1&&(div_inputbox.style.left="1px")}function checkTypeinAnswer(){let answer=document.getElementById("input_typein").value;answer=answer.trim(),answer=answer.toLowerCase(),answer=answer.replace(/-/g," ");let correct_answer=questions[quiz.current_question].item_title[quiz_language],correct_answer_shorttitle="";void 0!==questions[quiz.current_question].short_title&&void 0!==questions[quiz.current_question].short_title[quiz_language]&&(correct_answer_shorttitle=questions[quiz.current_question].short_title[quiz_language]),correct_answer=correct_answer.trim(),correct_answer=correct_answer.toLowerCase(),correct_answer=correct_answer.replace(/-/g," "),correct_answer_shorttitle=correct_answer_shorttitle.trim(),correct_answer_shorttitle=correct_answer_shorttitle.toLowerCase(),correct_answer_shorttitle=correct_answer_shorttitle.replace(/-/g," ");const umlauts=["√§","√∂","√º","√ü"],asciiEquivalents_2char=["ae","oe","ue","ss"];let correct_answer_normalized_2char=replaceStringsUsingArrays(correct_answer,umlauts,asciiEquivalents_2char),correct_answer_shorttitle_normalized_2char=replaceStringsUsingArrays(correct_answer_shorttitle,umlauts,asciiEquivalents_2char),svg_quiz_item=SVG.find("#"+questions[quiz.current_question].item_id)[0],lpos="none",extra_label="";if("place"==questions[quiz.current_question].type&&(lpos="top"),void 0!==questions[quiz.current_question].greater_region&&void 0!==questions[quiz.current_question].greater_region[quiz_language]){let arr_gregion=questions[quiz.current_question].greater_region[quiz_language].split("|");extra_label=arr_gregion.length>1?arr_gregion[1]+" "+arr_gregion[0]:"de"==quiz_language||"en"==quiz_language?"in "+arr_gregion[0]:arr_gregion[0]}let region_cx=0,region_cy=0;if(""==correct_answer_shorttitle&&(answer==correct_answer||answer==correct_answer_normalized_2char)||""!=correct_answer_shorttitle&&(answer==correct_answer||answer==correct_answer_normalized_2char||answer==correct_answer_shorttitle||answer==correct_answer_shorttitle_normalized_2char))if(playSound("correct"),0==questions[quiz.current_question].tries?colorQuizItem(map_colors.color_green,svg_quiz_item):1!=questions[quiz.current_question].tries&&2!=questions[quiz.current_question].tries||colorQuizItem(map_colors.color_yellow,svg_quiz_item),questions[quiz.current_question].done=!0,questions[quiz.current_question].tries++,quiz.current_question++,quiz.current_question==quiz.total_questions)quizDone();else{updateInfobars();let next_svg_quiz_item=SVG.find("#"+questions[quiz.current_question].item_id)[0];highlightQuizItem(next_svg_quiz_item),positionInputBox(next_svg_quiz_item),document.getElementById("input_typein").value="",document.getElementById("input_typein").focus()}else if(questions[quiz.current_question].tries++,3==questions[quiz.current_question].tries){if(questions[quiz.current_question].done=!0,questions[quiz.current_question].tries=4,"region"==questions[quiz.current_question].type||"path"==questions[quiz.current_question].type)if(void 0!==svg_quiz_item.data("xy")){let arr_xy=svg_quiz_item.data("xy").split(",");region_cx=arr_xy[0]*mod_x,region_cy=arr_xy[1]*mod_y}else region_cx=svg_quiz_item.cx()*mod_x,region_cy=svg_quiz_item.cy()*mod_y;else"place"==questions[quiz.current_question].type&&(region_cx=svg_quiz_item.findOne(".clickable").cx()*mod_x,region_cy=svg_quiz_item.findOne(".clickable").cy()*mod_y);if(animateLabel(region_cx,region_cy,questions[quiz.current_question].item_title[quiz_language],1e3,lpos,extra_label),playSound("failed"),colorQuizItem(map_colors.color_red,svg_quiz_item),quiz.current_question++,quiz.current_question==quiz.total_questions)quizDone();else{updateInfobars();let next_svg_quiz_item=SVG.find("#"+questions[quiz.current_question].item_id)[0];highlightQuizItem(next_svg_quiz_item),positionInputBox(next_svg_quiz_item),document.getElementById("input_typein").value="",document.getElementById("input_typein").focus()}}else playSound("incorrect"),animateRedToWhite()}document.getElementById("btn_mute").addEventListener("click",(function(){sound_on?(sound_on=!1,localStorage.setItem("sound_on","false"),document.getElementById("img_mute").src="ico/volume-mute-fill.svg"):(sound_on=!0,localStorage.removeItem("sound_on"),document.getElementById("img_mute").src="ico/volume-up-fill.svg")})),document.getElementById("btn_typein").addEventListener("click",(function(){checkTypeinAnswer()})),document.getElementById("input_typein").addEventListener("keyup",(function(e){"Enter"===e.key&&checkTypeinAnswer()})),document.getElementById("btn_show_all").addEventListener("click",(function(){labels_visible?(labels_visible=!1,document.getElementById("btn_show_all").innerHTML="Show places",SVG.find(".quiz_label").hide(),quiz_done||(pause_quiz=!1,updateInfobars(),tooltip_active=!0,game_mode!=GM_TYPEIN_ORDER&&game_mode!=GM_TYPEIN_NOORDER||(document.getElementById("div_type_in").classList.add("d-flex"),document.getElementById("div_type_in").style.display="block",document.getElementById("input_typein").focus(),tooltip_active=!1))):(showLabels(),tooltip_active=!1,quiz_done||(pause_quiz=!0,updateQuestionCaptions("Quiz is paused!","Quiz is paused!","none")),game_mode!=GM_TYPEIN_ORDER&&game_mode!=GM_TYPEIN_NOORDER||(document.getElementById("div_type_in").style.display="none",document.getElementById("div_type_in").classList.remove("d-flex")))})),document.getElementById("select_lang").addEventListener("change",(function(){if(quiz_language=this.value,localStorage.setItem(lS_qlang,quiz_language),!external_lang_loaded&&void 0!==quiz.lang_file){var cVer="";null!==sessionStorage.getItem("content_ver")&&(cVer="?v="+sessionStorage.getItem("content_ver")),getScript("quiz/"+quiz.lang_file+".min.js"+cVer,(function(){questions.forEach((function(q){let i_lang_data=getIndexOf(lang_data,q.item_id);!1!==i_lang_data&&Object.assign(q,lang_data[i_lang_data])})),"undefined"!=typeof legend_data&&legend.forEach((function(l){let i_legend_data=getIndexOf(legend_data,l.item_id);!1!==i_legend_data&&Object.assign(l,legend_data[i_legend_data])})),SVG.find(".quiz_label").remove(),labels_created=!1,labels_visible?showLabels():updateInfobars(),external_lang_loaded=!0}))}SVG.find(".quiz_label").remove(),labels_created=!1,labels_visible?showLabels():updateInfobars()})),document.getElementById("select_game_mode").addEventListener("change",(function(){let old_game_mode=game_mode,reset_needed=!1;game_mode=this.value,reset_needed=Number(old_game_mode)+Number(game_mode)>1,localStorage.setItem(lS_gmode,game_mode),!0===reset_needed?ResetGame():game_mode==GM_DEFAULT?recolorQuizItems():game_mode==GM_HIDE_ANSWER&&(SVG.find(".quiz_item.region").fill(map_colors.region_fill),SVG.find(".quiz_item.region").stroke({color:map_colors.region_stroke,width:map_settings.base_stroke_width}),SVG.find(".marker").fill(map_colors.place),SVG.find(".quiz_item.street").stroke({color:map_colors.street}),SVG.find(".quiz_item.river").stroke({color:map_colors.river}),SVG.find(".outline").attr({"stroke-width":2}))})),document.getElementById("btn_diffLvl").addEventListener("click",(function(){let str_content="<form>",str_checked=" checked";for(let i=0;i<difficulty_levels;i++)str_checked=i==current_difficulty?" checked":"",str_content+="<div class='form-check'>",str_content=str_content+"<input class='form-check-input' type='radio' value='"+i+"' name='radioChooseDiffLvl' id='radioChooseDiffLvl"+String(i+1)+"'"+str_checked+">",str_content=str_content+"<label class='form-check-label' for='radioChooseDiffLvl"+String(i+1)+"'>"+quiz.difficulty_labels[i].en+"</label>",str_content+="</div>";str_content+="</form>",document.getElementById("div_choose_difficulty").innerHTML=str_content,document.getElementById("btn_dismiss_choose_difficulty").style.display="block",modal_difficulty._config.keyboard=!0,modal_difficulty.show()})),document.getElementById("btn_choose_difficulty").addEventListener("click",(function(){current_difficulty=document.querySelector('input[name="radioChooseDiffLvl"]:checked').value,ResetGame(),localStorage.setItem(lS_diffLvl,current_difficulty),modal_difficulty.hide()})),document.getElementById("btn_show_img").addEventListener("click",(function(){document.getElementById("pic_quiz_modal_image").src="img/flags/"+questions[quiz.current_question].img_filename,modal_show_image.show()})),document.getElementById("btn_feedback").addEventListener("click",(function(){var modal_feedback;new bootstrap.Modal(document.getElementById("modal_feedback")).show()})),document.getElementById("btn_submit_feedback").addEventListener("click",(function(){var form=document.getElementById("form_feedback");if(!1===form.checkValidity())event.preventDefault(),event.stopPropagation(),form.classList.add("was-validated");else{let post_subject="Quiz: "+quiz.title+" (ID: "+quiz_id+")",post_name=document.getElementById("validationName").value,post_mail=document.getElementById("validationMail").value,post_feedback=document.getElementById("validationFeedback").value;var formData=new FormData;formData.append("post_subject",post_subject),formData.append("post_name",post_name),formData.append("post_mail",post_mail),formData.append("post_feedback",post_feedback);var request=new XMLHttpRequest;request.open("POST","send_feedback.php"),request.send(formData),form.classList.remove("was-validated"),form.reset();var modalEl=document.getElementById("modal_feedback"),modal_feedback;bootstrap.Modal.getInstance(modalEl).hide(),document.getElementById("btn_feedback").classList.remove("btn-light"),document.getElementById("btn_feedback").classList.add("btn-success"),document.getElementById("btn_feedback").innerHTML="Thanks!"}})),document.getElementById("btn_share").addEventListener("click",(function(){var popup_copied=document.getElementById("popup_copied"),solved=[],struggled=[],failed=[];for(let i=0;i<quiz.total_questions;i++)1==questions[i].tries?solved.push(questions[i].item_id):questions[i].tries>1&&questions[i].tries<4?struggled.push(questions[i].item_id):4==questions[i].tries&&failed.push(questions[i].item_id);var str_tocopy="Quiz: "+popup_copied.dataset.title+"\n";str_tocopy=str_tocopy+"üü¢ Correct answers: "+solved.length+"/"+quiz.total_questions+"\n",struggled.length>0&&(str_tocopy=str_tocopy+"üü° Struggled: "+struggled.length+"\n"),failed.length>0&&(str_tocopy=str_tocopy+"üî¥ Failed: "+failed.length+"\n");let minutes=Math.floor(timePassed/6e4),seconds=Math.floor(timePassed%6e4/1e3),milliseconds=timePassed%1e3,str_output_time=null;str_output_time=minutes>0?minutes+"m "+seconds+"s "+milliseconds+"ms":seconds+"s "+milliseconds+"ms",game_mode!=GM_TYPEIN_ORDER&&game_mode!=GM_TYPEIN_NOORDER&&(str_tocopy=str_tocopy+"‚è± Time: "+str_output_time+"\n"),str_tocopy=str_tocopy+"Proof: https://geographyquiz.app/result/"+url_params[1]+"/"+url_params[2]+"/"+popup_copied.dataset.hash,navigator.clipboard.writeText(str_tocopy).then((function(){})),popup_copied.classList.remove("invisible"),setTimeout((function(){popup_copied.classList.add("invisible")}),1200)}))}));